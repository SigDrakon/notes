

# 1. VPP软件架构

fd.io VPP 的实现是第三代向量数据包处理实现，为了性能，VPP 数据平面由一个 **转发节点** 的 **有向图** 组成，该图在每次调用时处理多个数据包。

这种机制使得各种微处理器优化得以实现：**流水线操作** 和 **预取** 以覆盖依赖读取延迟，固有的 **I-cache 阶段行为**，以及 **向量指令**。

除了硬件输入和硬件输出节点之外，整个转发图都是**可移植代码**。

根据具体场景，我们通常会启动多个 **工作线程**，它们使用相同的**转发图副本** 从多个队列处理**入站-哈希** 的数据包。

![image-20250928235027098](./assets/image-20250928235027098.png)

VPP分层的实现分类：

- VPP Infra：VPP 基础设施层，其中包含核心库源代码。该层执行**内存功能**，处理**向量和环**，在**哈希表**中执行**密钥查找**，并使用**计时器**来调度图节点。
- VLIB：**向量处理库**。VLIB 层还处理各种**应用管理功能**：**缓冲区、内存和图节点管理**，维护和导出**计数器**，**线程管理**，以及**数据包跟踪**。VLIB 实现了调试 **CLI（命令行接口）**。
- VNET：处理 VPP 的**网络接口**（第 2、3 和 4 层），执行**会话和流量管理**，并处理**设备**和**数据控制平面**。
- Plugins：包含一套日益丰富的**数据平面插件**，如上图（*原文提及，但未提供*）所示。