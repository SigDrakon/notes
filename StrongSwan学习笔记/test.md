# 1. 前提条件

本文档默认读者具备以下能力：

- 理解网络基础原理，包括 IP 地址和 DNS 服务器配置，以及基础防火墙设置。
- 掌握基于公钥密码学和公钥基础设施（PKI）的基本认证概念。
- 知道如何按照说明安装二进制软件包或编译源代码。
- 熟练操作命令行。

若不具备上述知识，可使用许多现成的设备来提供远程 IPsec 访问。



# 2. 网络安全防护

StrongSwan 是一套完整的 IPsec 解决方案，可为服务器和客户端提供加密与认证功能。它可用于保护与远程网络的通信，使远程连接体验与本地连接一致。

![image-20251115163404023](./assets/image-20251115163404023.png)

- Gateway：

  网关通常是防火墙，也可以是网络中的任意主机。网关通常还能为小型网络提供 DHCP 和 DNS 服务。在图示中，主机 moon 和 sun 分别是内部主机 alice、venus 和 bob 的网关。

- Remote Access / Roadwarrior Clients：

  漫游客户端通常指笔记本电脑及其他移动设备，它们通过网关远程连接到家庭网络。在图示中，carol 和 dave 代表漫游客户端，它们希望访问两个网关背后的任意一个网络。

- Remote Hosts / Host-to-Host：

  远程主机可以是远程 Web 服务器或备份系统。图示中，主机 winnetou 与网关 moon、sun 中的任意一个的连接，就是该场景的示例。两台主机之间的连接通常可由任意一方发起。

- Remote Sites / Site-to-Site：

  位于不同地点的两个或多个子网中的主机，应能实现互访。再次参考图示，网关 moon 和 sun 背后的两个子网（10.1.0.0/16 和 10.2.0.0/16）可通过连接实现互访，例如主机 alice 和 bob 能安全地通信。





# 3. IKE 和 IPSec 基础







# 4. 认证基础





# 5. 配置文件





## 5.1. 其他配置来源





# 6. 安装





# 7. 调用与维护





# 8. 日志与监控





# 9. PKI (公钥基础设施)



## 9.1. 证书要求



## 9.2. 证书相关说明





# 10. 路由





# 11. 远程访问配置



## 11.1. IKEv2 配置



# 12. site-to-site 配置





# 13. host-to-host 配置























